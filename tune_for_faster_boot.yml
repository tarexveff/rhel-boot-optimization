---
- name: Boot quicker
  hosts: edge
  become: yes 
  vars:
      disablemodules:
        - 8250_lpss
        - aacraid
        - abituguru
        - abituguru3
        - ac97_bus
        - acer-wireless
        - acer-wmi
        - ad7414
        - ad7418
        - adm1021
        - adm1025
        - adm1026
        - adm1029
        - adm1031
        - adm1275
        - adm9240
        - ads7828
        - adt7410
        - adt7411
        - adt7462
        - adt7470
        - adt7475
        - adt7x10
        - adutux
        - aircable
        - altera-stapl
        - amc6821
        - amd64_edac
        - amd_freq_sensitivity
        - amdgpu
        - amd_hsmp
        - amd-pmc
        - amd-rng
        - amd_sfh
        - amilo-rfkill
        - apds9802als
        - apds990x
        - apple_bl
        - appledisplay
        - apple-gmux
        - applesmc
        - arc_uart
        - ark3116
        - asb100
        - asc7621
        - ast
        - asus_atk0110
        - asus-laptop
        - asus-nb-wmi
        - asus-wmi
        - ath3k
        - atxp1
        - bcm203x
        - bcma
        - be2iscsi
        - belkin_sa
        - bfusb
        - bh1770glc
        - binfmt_misc
        - blocklayoutdriver
        - bnx2fc
        - bnx2i
        - bnxt_re
        - bochs
        - bpa10x
        - brd
        - btbcm
        - btmrvl
        - btmrvl_sdio
        - btmtk
        - btrtl
        - btsdio
        - btusb
        - cachefiles
        - cb710
        - cdc-acm
        - cdc-wdm
        - cdrom
        - cec
        - ceph
        - ch
        - ch341
        - cifs
        - cifs_arc4
        - cifs_md4
        - cirrus
        - compal-laptop
        - cordic
        - coretemp
        - counter
        - cp210x
        - cs_dsp
        - csiostor
        - cxacru
        - cxgb4i
        - cxgbit
        - cxl_mem
        - cxl_pci
        - cxl_pmem
        - cyberjack
        - cypress_m8
        - dax_hmem
        - dax_pmem
        - dax_pmem_compat
        - dax_pmem_core
        - dca
        - dcdbas
        - dell-laptop
        - dell-rbtn
        - dell_rbu
        - dell-smbios
        - dell-smm-hwmon
        - dell-smo8800
        - dell-wmi
        - dell-wmi-aio
        - dell-wmi-descriptor
        - dell-wmi-led
        - device_dax
        - digi_acceleport
        - dlm
        - dme1737
        - drm
        - drm_buddy
        - drm_display_helper
        - drm_kms_helper
        - drm_shmem_helper
        - drm_ttm_helper
        - drm_vram_helper
        - ds1621
        - ds620
        - dummy_stm
        - dwc2
        - dwc3
        - dwc3-haps
        - dwc3-pci
        - dw_dmac
        - e752x_edac
        - edac_mce_amd
        - edd
        - eeepc-laptop
        - eeepc-wmi
        - eeprom
        - eeprom_93cx6
        - efa
        - efi_secret
        - emc1403
        - emc6w201
        - emi26
        - emi62
        - empeg
        - enclosure
        - exfat
        - ext4
        - ezusb
        - f71805f
        - f71882fg
        - f75375s
        - f81534
        - fam15h_power
        - fat
        - faulty
        - firmware_attributes_class
        - fnic
        - fsa4480
        - fscache
        - fschmd
        - ftdi-elan
        - ftdi_sio
        - fujitsu-laptop
        - fujitsu-tablet
        - fusb302
        - g760a
        - garmin_gps
        - gfs2
        - gl518sm
        - gl520sm
        - gm12u320
        - gnss
        - gpio-amdpt
        - gpio-generic
        - gpio-ich
        - gpu-sched
        - grace
        - gru
        - gspca_benq
        - gspca_conex
        - gspca_cpia1
        - gspca_etoms
        - gspca_finepix
        - gspca_gl860
        - gspca_jeilinj
        - gspca_jl2005bcd
        - gspca_konica
        - gspca_m5602
        - gspca_main
        - gspca_mars
        - gspca_mr97310a
        - gspca_nw80x
        - gspca_ov519
        - gspca_ov534
        - gspca_ov534_9
        - gspca_pac207
        - gspca_pac7302
        - gspca_pac7311
        - gspca_se401
        - gspca_sn9c2028
        - gspca_sn9c20x
        - gspca_sonixb
        - gspca_sonixj
        - gspca_spca1528
        - gspca_spca500
        - gspca_spca501
        - gspca_spca505
        - gspca_spca506
        - gspca_spca508
        - gspca_spca561
        - gspca_sq905
        - gspca_sq905c
        - gspca_sq930x
        - gspca_stk014
        - gspca_stv0680
        - gspca_stv06xx
        - gspca_sunplus
        - gspca_t613
        - gspca_topro
        - gspca_tv8532
        - gspca_vc032x
        - gspca_vicam
        - gspca_xirlink_cit
        - gspca_zc3xx
        - gud
        - hangcheck-timer
        - hci_uart
        - hci_vhci
        - hdaps
        - hfi1
        - hid-a4tech
        - hid-alps
        - hid-apple
        - hid-appleir
        - hid-asus
        - hid-aureal
        - hid-axff
        - hid-belkin
        - hid-betopff
        - hid-cherry
        - hid-chicony
        - hid-cmedia
        - hid-corsair
        - hid-cougar
        - hid-cypress
        - hid-dr
        - hid-elan
        - hid-elecom
        - hid-elo
        - hid-ezkey
        - hid-gaff
        - hid-gembird
        - hid-gfrm
        - hid-gt683r
        - hid-gyration
        - hid-holtekff
        - hid-holtek-kbd
        - hid-holtek-mouse
        - hid-hyperv
        - hid-icade
        - hid-ite
        - hid-jabra
        - hid-kensington
        - hid-keytouch
        - hid-kye
        - hid-lcpower
        - hid-led
        - hid-lenovo
        - hid-letsketch
        - hid-lg-g15
        - hid-logitech
        - hid-logitech-dj
        - hid-logitech-hidpp
        - hid-microsoft
        - hid-monterey
        - hid-multitouch
        - hid-nti
        - hid-ortek
        - hid-penmount
        - hid-petalynx
        - hid-picolcd
        - hid-pl
        - hid-plantronics
        - hid-primax
        - hid-prodikeys
        - hid-rmi
        - hid-roccat
        - hid-roccat-arvo
        - hid-roccat-common
        - hid-roccat-isku
        - hid-roccat-kone
        - hid-roccat-koneplus
        - hid-roccat-konepure
        - hid-roccat-kovaplus
        - hid-roccat-lua
        - hid-roccat-pyra
        - hid-roccat-ryos
        - hid-roccat-savu
        - hid-saitek
        - hid-samsung
        - hid-semitek
        - hid-sensor-accel-3d
        - hid-sensor-als
        - hid-sensor-custom
        - hid-sensor-gyro-3d
        - hid-sensor-humidity
        - hid-sensor-iio-common
        - hid-sensor-incl-3d
        - hid-sensor-press
        - hid-sensor-prox
        - hid-sensor-rotation
        - hid-sensor-temperature
        - hid-sensor-trigger
        - hid-sigmamicro
        - hid-sjoy
        - hid-sony
        - hid-speedlink
        - hid-steelseries
        - hid-sunplus
        - hid-thrustmaster
        - hid-tivo
        - hid-tmff
        - hid-topseed
        - hid-twinhan
        - hid-uclogic
        - hid-waltop
        - hid-wiimote
        - hid-xiaomi
        - hid-xinmo
        - hid-zpff
        - hid-zydacron
        - hp_accel
        - hpilo
        - hpsa
        - hpwdt
        - hp-wmi
        - hv_balloon
        - hv_storvsc
        - hv_utils
        - hv_vmbus
        - hwmon-vid
        - hwpoison-inject
        - hyperv_drm
        - i10nm_edac
        - i3000_edac
        - i3200_edac
        - i5000_edac
        - i5100_edac
        - i5400_edac
        - i5500_temp
        - i5k_amb
        - i6300esb
        - i7300_edac
        - i7core_edac
        - i82975x_edac
        - i915
        - ib700wdt
        - ib_cm
        - ib_core
        - ib_ipoib
        - ib_iser
        - ib_isert
        - ibmaem
        - ibmasr
        - ibmpex
        - ib_srp
        - ib_srpt
        - ib_umad
        - ib_uverbs
        - ideapad-laptop
        - idma64
        - idmouse
        - idxd
        - idxd_bus
        - ie31200_edac
        - ifcvf
        - igen6_edac
        - ina209
        - ina2xx
        - industrialio
        - industrialio-triggered-buffer
        - intel_rapl_msr
        - intel_rapl_common
        - ioatdma
        - io_edgeport
        - io_ti
        - iowarrior
        - ipaq
        - ipmi_devintf
        - ipmi_msghandler
        - ipmi_poweroff
        - ipmi_si
        - ipmi_ssif
        - ipmi_watchdog
        - ipw
        - irdma
        - irqbypass
        - ir-usb
        - iscsi_ibft
        - iscsi_target_mod
        - iscsi_tcp
        - isight_firmware
        - isl29003
        - isl29020
        - isofs
        - it87
        - iTCO_vendor_support
        - iTCO_wdt
        - iuu_phoenix
        - iw_cm
        - iw_cxgb4
        - jbd2
        - jc42
        - jmb38x_ms
        - jsm
        - k10temp
        - k8temp
        - keyspan
        - keyspan_pda
        - kfifo_buf
        - kheaders
        - kl5kusb105
        - kmem
        - kobil_sct
        - korg1212
        - kvm
        - kvm-amd
        - kvmgt
        - lcd
        - ldusb
        - leds-blinkm
        - leds-clevo-mail
        - leds-lm3530
        - leds-lp3944
        - leds-lt3593
        - leds-mlxcpld
        - leds-mlxreg
        - leds-ss4200
        - ledtrig-audio
        - ledtrig-backlight
        - ledtrig-camera
        - ledtrig-default-on
        - ledtrig-gpio
        - ledtrig-heartbeat
        - ledtrig-oneshot
        - ledtrig-timer
        - ledtrig-transient
        - ledtrig-usbport
        - legousbtower
        - libcxgbi
        - libfc
        - libfcoe
        - libiscsi
        - libiscsi_tcp
        - libnvdimm
        - libsas
        - lineage-pem
        - linear
        - linear_ranges
        - lis3lv02d
        - lm25066
        - lm63
        - lm73
        - lm75
        - lm77
        - lm78
        - lm80
        - lm83
        - lm85
        - lm87
        - lm90
        - lm92
        - lm93
        - lm95234
        - lm95241
        - lm95245
        - lockd
        - loop
        - lp
        - lp855x_bl
        - lpc_ich
        - lpc_sch
        - lpfc
        - ltc2978
        - ltc4151
        - ltc4215
        - ltc4245
        - ltc4261
        - lz4_compress
        - mac-celtic
        - mac-centeuro
        - mac-croatian
        - mac-cyrillic
        - mac-gaelic
        - mac-greek
        - mac-iceland
        - mac-inuit
        - mac-roman
        - mac-romanian
        - mac-turkish
        - max16064
        - max16065
        - max1619
        - max1668
        - max197
        - max34440
        - max6639
        - max6642
        - max6650
        - max6697
        - max6875
        - max8688
        - mbcache
        - mc
        - mcp3021
        - mct_u232
        - mdc800
        - mdev
        - megaraid_sas
        - mei
        - mei-gsc
        - mei-me
        - mei_wdt
        - memstick
        - mgag200
        - mhi
        - mhi_pci_generic
        - microtek
        - mlx4_ib
        - mlx5_ib
        - mlx5_vdpa
        - mlx-platform
        - mlxreg-fan
        - mlxreg-hotplug
        - mlxreg-io
        - mlxreg-lc
        - mlx_wdt
        - mos7720
        - mos7840
        - mpi3mr
        - mpt3sas
        - mptbase
        - mptsas
        - mptscsih
        - mptspi
        - msdos
        - msi-laptop
        - msi-wmi
        - mspro_block
        - mxm-wmi
        - mxuport
        - navman
        - nbd
        - nct6775
        - nd_blk
        - nd_btt
        - nd_e820
        - nd_pmem
        - nfs
        - nfs_acl
        - nfsd
        - nfs_layout_flexfiles
        - nfs_layout_nfsv41_files
        - nfsv3
        - nfsv4
        - n_gsm
        - n_hdlc
        - nitro_enclaves
        - nls_cp1250
        - nls_cp1251
        - nls_cp1255
        - nls_cp737
        - nls_cp775
        - nls_cp850
        - nls_cp852
        - nls_cp855
        - nls_cp857
        - nls_cp860
        - nls_cp861
        - nls_cp862
        - nls_cp863
        - nls_cp864
        - nls_cp865
        - nls_cp866
        - nls_cp869
        - nls_cp874
        - nls_cp932
        - nls_cp936
        - nls_cp949
        - nls_cp950
        - nls_euc-jp
        - nls_iso8859-1
        - nls_iso8859-13
        - nls_iso8859-14
        - nls_iso8859-15
        - nls_iso8859-2
        - nls_iso8859-3
        - nls_iso8859-4
        - nls_iso8859-5
        - nls_iso8859-6
        - nls_iso8859-7
        - nls_iso8859-9
        - nls_koi8-r
        - nls_koi8-ru
        - nls_koi8-u
        - nls_utf8
        - nouveau
        - nozomi
        - ntb
        - ntb_hw_amd
        - ntb_msi_test
        - ntb_perf
        - ntb_pingpong
        - ntb_tool
        - ntb_transport
        - ntc_thermistor
        - null_blk
        - nvsw-sn2201
        - objagg
        - opa_vnic
        - opticon
        - option
        - oti6858
        - overlay
        - p4-clockmod
        - panasonic-laptop
        - parman
        - parport
        - parport_pc
        - parport_serial
        - pc87360
        - pc87427
        - pcf8591
        - pci-hyperv
        - pci-hyperv-intf
        - pci-pf-stub
        - pcspkr
        - pi3usb30532
        - pktcdvd
        - pl2303
        - platform_lcd
        - pmbus
        - pmbus_core
        - pnd2_edac
        - powernow-k8
        - ppdev
        - pps-gpio
        - pps-ldisc
        - pps_parport
        - ptdma
        - ptp_kvm
        - ptp_vmw
        - pulse8-cec
        - pvpanic
        - pvpanic-mmio
        - pwc
        - pwm-lpss
        - pwm-lpss-pci
        - pwm-lpss-platform
        - qcaux
        - qcserial
        - qedf
        - qedi
        - qedr
        - qla2xxx
        - qla4xxx
        - qmi_helpers
        - quatech2
        - qxl
        - r592
        - radeon
        - raid0
        - raid1
        - raid10
        - raid456
        - raid6_pq
        - raid_class
        - rainshadow-cec
        - ramoops
        - rapl
        - rbd
        - rdma_cm
        - rdma_ucm
        - rdmavt
        - reed_solomon
        - regmap-sdw
        - regmap-sdw-mbq
        - regmap-spi
        - rfkill
        - ring_buffer_benchmark
        - rt1719
        - rtc-bq32k
        - rtc-bq4802
        - rtc-ds1286
        - rtc-ds1307
        - rtc-ds1374
        - rtc-ds1511
        - rtc-ds1553
        - rtc-ds1672
        - rtc-ds1742
        - rtc-ds2404
        - rtc-ds3232
        - rtc-em3027
        - rtc-fm3130
        - rtc-isl12022
        - rtc-isl1208
        - rtc-m41t80
        - rtc-m48t35
        - rtc-m48t59
        - rtc-max6900
        - rtc-msm6242
        - rtc-pcf8523
        - rtc-pcf8563
        - rtc-pcf8583
        - rtc-rp5c01
        - rtc-rs5c372
        - rtc-rv3029c2
        - rtc-rv8803
        - rtc-rx4581
        - rtc-rx8025
        - rtc-rx8581
        - rtc-stk17ta8
        - rtc-v3020
        - rtc-x1205
        - rtsx_pci
        - rtsx_pci_ms
        - rtsx_usb
        - rtsx_usb_ms
        - s2255drv
        - safe_serial
        - samsung-laptop
        - samsung-q10
        - sb_edac
        - sch5627
        - sch5636
        - sch56xx-common
        - scsi_debug
        - scsi_transport_fc
        - scsi_transport_iscsi
        - scsi_transport_sas
        - scsi_transport_spi
        - scsi_transport_srp
        - serial-multi-instantiate
        - ses
        - sev-guest
        - sg
        - sht15
        - sht21
        - sierra
        - sis5595
        - sisusbvga
        - siw
        - skx_edac
        - sm501
        - smartpqi
        - smb347-charger
        - smsc47b397
        - smsc47m1
        - smsc47m192
        - snd
        - snd-ac97-codec
        - snd-acp3x-rn
        - snd-acp5x-i2s
        - snd-acp5x-pcm-dma
        - snd-acp-config
        - snd-ad1889
        - snd-ali5451
        - snd-aloop
        - snd-asihpi
        - snd-atiixp
        - snd-atiixp-modem
        - snd-au8810
        - snd-au8820
        - snd-au8830
        - snd-bcd2000
        - snd-bt87x
        - snd-ca0106
        - snd-cmipci
        - snd-compress
        - snd-cs46xx
        - snd-ctl-led
        - snd-ctxfi
        - snd-darla20
        - snd-darla24
        - snd-dummy
        - snd-echo3g
        - snd-emu10k1
        - snd-emu10k1-synth
        - snd-emu10k1x
        - snd-emux-synth
        - snd-ens1370
        - snd-ens1371
        - snd-es1968
        - snd-gina20
        - snd-gina24
        - snd-hda-codec
        - snd-hda-codec-analog
        - snd-hda-codec-ca0110
        - snd-hda-codec-ca0132
        - snd-hda-codec-cirrus
        - snd-hda-codec-cmedia
        - snd-hda-codec-conexant
        - snd-hda-codec-cs8409
        - snd-hda-codec-generic
        - snd-hda-codec-hdmi
        - snd-hda-codec-idt
        - snd-hda-codec-realtek
        - snd-hda-codec-si3054
        - snd-hda-codec-via
        - snd-hda-core
        - snd-hda-cs-dsp-ctls
        - snd-hda-ext-core
        - snd-hda-scodec-cs35l41
        - snd-hda-scodec-cs35l41-spi
        - snd-hdmi-lpe-audio
        - snd-hdsp
        - snd-hdspm
        - snd-hrtimer
        - snd-hwdep
        - snd-ice1712
        - snd-ice1724
        - snd-ice17xx-ak4xxx
        - snd-indigo
        - snd-indigodj
        - snd-indigodjx
        - snd-indigoio
        - snd-indigoiox
        - snd-intel8x0
        - snd-korg1212
        - snd-layla20
        - snd-layla24
        - snd-lola
        - snd-lx6464es
        - snd-maestro3
        - snd-mia
        - snd-mixart
        - snd-mona
        - snd-mpu401
        - snd-mpu401-uart
        - snd-mtpav
        - snd-opl3-lib
        - snd-opl3-synth
        - snd-oxygen
        - snd-oxygen-lib
        - snd-pci-acp5x
        - snd-pci-acp6x
        - snd-pci-ps
        - snd-pcm
        - snd-pcsp
        - snd-pcxhr
        - snd-rawmidi
        - snd-rme32
        - snd-rme96
        - snd-rme9652
        - snd-rn-pci-acp3x
        - snd-seq
        - snd-seq-device
        - snd-seq-dummy
        - snd-seq-midi
        - snd-seq-midi-emul
        - snd-seq-midi-event
        - snd-seq-virmidi
        - snd-soc-acp5x-mach
        - snd-soc-acp6x-mach
        - snd-soc-core
        - snd-soc-cs35l41
        - snd-soc-cs35l41-lib
        - snd-soc-cs35l41-spi
        - snd-soc-cs42l42
        - snd-soc-cx2072x
        - snd-soc-da7213
        - snd-soc-da7219
        - snd-soc-dmic
        - snd-soc-es8316
        - snd-soc-hdac-hda
        - snd-soc-hdac-hdmi
        - snd-soc-hda-codec
        - snd-soc-max98090
        - snd-soc-max98357a
        - snd-soc-max98373
        - snd-soc-max98373-sdw
        - snd-soc-max98390
        - snd-soc-max98927
        - snd-soc-nau8821
        - snd-soc-nau8824
        - snd-soc-nau8825
        - snd-soc-pcm512x
        - snd-soc-ps-mach
        - snd-soc-rl6231
        - snd-soc-rl6347a
        - snd-soc-rt1011
        - snd-soc-rt1015
        - snd-soc-rt1015p
        - snd-soc-rt1308
        - snd-soc-rt1308-sdw
        - snd-soc-rt1316-sdw
        - snd-soc-rt1318-sdw
        - snd-soc-rt286
        - snd-soc-rt298
        - snd-soc-rt5514
        - snd-soc-rt5514-spi
        - snd-soc-rt5640
        - snd-soc-rt5645
        - snd-soc-rt5651
        - snd-soc-rt5660
        - snd-soc-rt5663
        - snd-soc-rt5670
        - snd-soc-rt5677
        - snd-soc-rt5677-spi
        - snd-soc-rt5682
        - snd-soc-rt5682s
        - snd-soc-rt5682-sdw
        - snd-soc-rt700
        - snd-soc-rt711
        - snd-soc-rt711-sdca
        - snd-soc-rt715
        - snd-soc-rt715-sdca
        - snd-soc-ssm4567
        - snd-soc-ts3a227e
        - snd-soc-wm8804
        - snd-soc-wm-adsp
        - snd-sof
        - snd-sof-amd-acp
        - snd-sof-amd-renoir
        - snd-sof-pci
        - snd-sof-probes
        - snd-sof-utils
        - snd-sof-xtensa-dsp
        - snd-timer
        - snd-trident
        - snd-ua101
        - snd-usb-6fire
        - snd-usb-audio
        - snd-usb-caiaq
        - snd-usb-hiface
        - snd-usb-line6
        - snd-usbmidi-lib
        - snd-usb-pod
        - snd-usb-podhd
        - snd-usb-toneport
        - snd-usb-us122l
        - snd-usb-usx2y
        - snd-usb-variax
        - snd-util-mem
        - snd-via82xx
        - snd-via82xx-modem
        - snd-virmidi
        - snd-virtuoso
        - snd-vx222
        - snd-vx-lib
        - snd_xen_front
        - softdog
        - sony-laptop
        - soundcore
        - soundwire-bus
        - soundwire-cadence
        - soundwire-generic-allocation
        - sp5100_tco
        - spcp8x5
        - speedstep-lib
        - speedtch
        - spi-pxa2xx-pci
        - spi-pxa2xx-platform
        - squashfs
        - sr_mod
        - ssu100
        - st
        - stkwebcam
        - stm_console
        - stm_core
        - stm_ftrace
        - stm_heartbeat
        - stm_p_basic
        - symbolserial
        - synclink_gt
        - t10-pi
        - target_core_file
        - target_core_iblock
        - target_core_mod
        - target_core_pscsi
        - target_core_user
        - tcm_fc
        - tcm_loop
        - tcpci
        - tcpm
        - tdx-guest
        - tee
        - think-lmi
        - thmc50
        - tifm_7xx1
        - tifm_core
        - tifm_ms
        - timeriomem-rng
        - ti_usb_3410_5052
        - tlclk
        - tmp102
        - tmp401
        - tmp421
        - topstar-laptop
        - toshiba_bluetooth
        - tps6598x
        - ts_bm
        - ts_fsm
        - ts_kmp
        - tsl2550
        - ttm
        - typec_displayport
        - uas
        - ucd9000
        - ucd9200
        - udf
        - udl
        - ueagle-atm
        - uhid
        - uio
        - uio_hv_generic
        - uio_pci_generic
        - ums-alauda
        - ums-cypress
        - ums-datafab
        - ums-eneub6250
        - ums-freecom
        - ums-isd200
        - ums-jumpshot
        - ums-karma
        - ums-realtek
        - ums-sddr09
        - ums-sddr55
        - ums-usbat
        - upd78f0730
        - usb3503
        - usbatm
        - usb_debug
        - usblcd
        - usblp
        - usbsevseg
        - usb-storage
        - usbtmc
        - usb_wwan
        - usnic_verbs
        - uss720
        - uvcvideo
        - uv_mmtimer
        - v4l2-dv-timings
        - vdpa
        - vdpa_sim
        - vdpa_sim_blk
        - vfat
        - vfio
        - vfio-pci
        - vfio-pci-core
        - vfio_virqfd
        - vhost
        - vhost_iotlb
        - vhost_vdpa
        - vhost_vsock
        - via686a
        - via-cputemp
        - via-rng
        - videobuf2-common
        - videobuf2-memops
        - videobuf2-v4l2
        - videobuf2-vmalloc
        - videobuf-core
        - videobuf-vmalloc
        - videodev
        - virtio_balloon
        - virtio_blk
        - virtio_console
        - virtio_dma_buf
        - virtiofs
        - virtio-gpu
        - virtio_mem
        - virtio_scsi
        - virtio_snd
        - virtio_vdpa
        - visor
        - vkms
        - vmw_balloon
        - vmwgfx
        - vmw_pvrdma
        - vmw_pvscsi
        - vmw_vmci
        - vp_vdpa
        - vringh
        - vt1211
        - vt8231
        - vx855
        - w83627ehf
        - w83627hf
        - w83781d
        - w83791d
        - w83792d
        - w83793
        - w83795
        - w83l785ts
        - w83l786ng
        - wacom
        - wdat_wdt
        - whiteheat
        - wireless-hotkey
        - wmi
        - wmi-bmof
        - wusb3801
        - x38_edac
        - xen-blkfront
        - xen-evtchn
        - xen-front-pgdir-shbuf
        - xenfs
        - xen-privcmd
        - xhci-plat-hcd
        - xp
        - xpc
        - xsens_mt
        - xusbatm
        - zl6100
        - zr364xx
        - zram
        - zstd_compress
      grub_options:
        - quiet
        - loglevel=0
        - audit=off
        - bgrt_disable
        - boot_delay=0
        - cpuidle.off=1
        - cpufreq.off=1
        - hibernate=no
        - ipv6.disable=
        - nohibernate
        - pnpacpi=off
        - systemd.show_status=false
        - rd.udev.log_level=0
        - rd.udev.log-priority=3
        - thermal.off=1
        - usbcore.nousb
        - vt.global_cursor_default=0

      systemctl_services:
        - auditd
        - nis-domainname
        - rhsmcertd
        - rsyslog

  tasks:
   - name: Blacklist kernel modules
     community.general.kernel_blacklist:
       name: "{{ item }}"
       state: present
     loop: "{{ disablemodules }}"
     tags:
       - kernel
       - blacklist

   - name: Omit modules from intramfs
     ansible.builtin.command: /usr/bin/dracut --omit-drivers "{{ disablemodules | join(' ') }}" -f
     tags:
       - kernel
       - omit

   - name: create grub command line
     set_fact:
       grub_cmdline: "{{ grub_cmdline | default( '' ) }} {{ item }}"
     with_items: "{{ grub_options }}"
     tags:
       - kernel
       - grub2

   - name: trim command line
     set_fact:
       grub_cmdline: "{{ grub_cmdline | regex_replace( '^ ', '' ) }}"
     tags:
       - kernel
       - grub2

   - debug:
       msg: "The GRUB_CMDLINE_LINUX variable in '/etc/default/grub' will be updated to '{{ grub_cmdline }}'."
     tags:
       - kernel
       - grub2

   - name: Update grub command line
     ansible.builtin.replace: 
       path: "/etc/default/grub"
       regexp: '^GRUB_CMDLINE_LINUX=.*'
       replace: "GRUB_CMDLINE_LINUX=\"{{ grub_cmdline }}\""
     become: true
     tags:
       - kernel
       - grub2

   - name: Update grub2
     ansible.builtin.command: /usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg
     tags:
       - kernel
       - grub2

   - name: Disable services
     ansible.builtin.service:
       name: "{{ item }}"
       enabled: no
     loop: "{{ systemctl_services }}"
     tags:
       - services
